{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/kenryu42/claude-code-safety-net/main/assets/cc-safety-net.schema.json",
  "title": "Safety Net Configuration",
  "description": "Configuration file for cc-safety-net plugin custom rules",
  "type": "object",
  "additionalProperties": false,
  "required": ["version"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference for IDE support"
    },
    "version": {
      "type": "integer",
      "const": 1,
      "description": "Schema version (must be 1)"
    },
    "rules": {
      "type": "array",
      "default": [],
      "description": "Custom blocking rules",
      "items": {
        "$ref": "#/$defs/CustomRule"
      }
    }
  },
  "$defs": {
    "CustomRule": {
      "type": "object",
      "description": "A custom rule that blocks specific command patterns",
      "additionalProperties": false,
      "required": ["name", "command", "block_args", "reason"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Unique identifier for the rule (case-insensitive for duplicate detection)",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_-]{0,63}$",
          "examples": ["block-git-add-all", "block-npm-global"]
        },
        "command": {
          "type": "string",
          "description": "Base command to match (e.g., 'git', 'npm', 'docker'). Paths are normalized to basename.",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_-]*$",
          "examples": ["git", "npm", "docker"]
        },
        "subcommand": {
          "type": "string",
          "description": "Optional subcommand to match (e.g., 'add', 'install'). If omitted, matches any subcommand.",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_-]*$",
          "examples": ["add", "install", "system"]
        },
        "block_args": {
          "type": "array",
          "description": "Arguments that trigger the block. Command is blocked if ANY of these are present.",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1,
            "description": "Argument to block (literal match, short options are expanded)"
          },
          "examples": [["-A", "--all", "."], ["-g", "--global"]]
        },
        "reason": {
          "type": "string",
          "description": "Message shown when the command is blocked",
          "minLength": 1,
          "maxLength": 256,
          "examples": ["Use 'git add <specific-files>' instead of blanket add."]
        }
      }
    }
  }
}
